{% extends 'core/base.html' %}
{% load static %}

{% block title %}Оплата — LeaseGrow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'control_panel/css/control_panel.css' %}">
<style>
.pay-root { max-width: 500px; margin: 2rem auto 3rem; padding: 0 1.5rem; }
.pay-item { padding: 0.75rem; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 0.5rem; }
.pay-custom { margin-top: 1.25rem; padding: 1.25rem; border: 1px solid var(--border); border-radius: 10px; background: var(--white); }
.pay-custom-label { font-size: 0.95rem; margin-bottom: 0.75rem; color: var(--text-secondary); }
.pay-custom-inner { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; }
.pay-custom-input { padding: 0.65rem 1rem; font-size: 1.1rem; width: 160px; border: 1px solid var(--border); border-radius: 8px; font-family: inherit; }
.pay-custom-input:focus { outline: none; border-color: var(--green-500); box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2); }
.pay-back { display: inline-block; margin-top: 1.5rem; padding: 0.5rem 1rem; font-size: 0.9rem; font-weight: 500; color: var(--text-secondary); text-decoration: none; border: 1px solid var(--border); border-radius: var(--radius); background: var(--white); transition: background 0.2s, border-color 0.2s; }
.pay-back:hover { background: var(--green-50, #f0fdf4); border-color: var(--green-200); color: var(--green-700); }
</style>
{% endblock %}

{% block content %}
<div class="console-root pay-root">
    <div class="console-card">
        <h2>Оплата по договору {{ contract.contract_number }}</h2>
        <p class="console-subtitle">{{ contract.equipment.name }} · {{ contract.monthly_payment|floatformat:0 }} ₽/мес</p>

        {% if payments %}
        <p style="margin-top: 1rem;">Ожидающие платежи:</p>
        {% for p in payments %}
        <div class="pay-item">
            Платёж #{{ p.payment_number }} — {{ p.due_date|date:"d.m.Y" }} — {{ p.amount|floatformat:0 }} ₽
            <form method="post" style="display: inline; margin-left: 0.5rem;">
                {% csrf_token %}
                <input type="hidden" name="payment_id" value="{{ p.id }}">
                <input type="hidden" name="amount" value="{{ p.amount }}">
                <button type="submit" class="btn-xs primary">Оплатить</button>
            </form>
        </div>
        {% endfor %}
        {% endif %}

        <div class="pay-custom">
            <p class="pay-custom-label">Или введите произвольную сумму:</p>
            <form method="post" class="pay-custom-inner">
                {% csrf_token %}
                <input type="number" name="amount" step="0.01" min="0.01" placeholder="{{ contract.monthly_payment|floatformat:0 }}" class="pay-custom-input">
                <button type="submit" class="btn-xs primary">Оплатить</button>
            </form>
        </div>

        <a href="{% url 'core:my_equipment' %}" class="pay-back">Назад</a>
    </div>
</div>
{% endblock %}
