{% extends 'core/base.html' %}
{% load static %}

{% block title %}Мои чаты — LeaseGrow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'control_panel/css/control_panel.css' %}">
<style>
.chat-root { max-width: 700px; margin: 2rem auto 3rem; padding: 0 1.5rem; }
.chat-header { margin-bottom: 1.5rem; }
.chat-title { font-size: 1.5rem; font-weight: 600; margin: 0 0 0.25rem 0; }
.chat-subtitle { color: var(--text-muted); font-size: 0.95rem; }
.conv-list { display: flex; flex-direction: column; gap: 0.75rem; }
.conv-item {
    display: block;
    padding: 1rem 1.25rem;
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    text-decoration: none;
    color: inherit;
    transition: border-color 0.2s, box-shadow 0.2s;
}
.conv-item:hover { border-color: var(--green-200); box-shadow: var(--shadow-sm); }
.conv-item h3 { font-size: 1.1rem; margin: 0 0 0.25rem 0; }
.conv-item .meta { font-size: 0.85rem; color: var(--text-muted); }
.conv-item .status { font-size: 0.8rem; font-weight: 600; margin-top: 0.5rem; }
.conv-item .status.pending { color: var(--amber-500); }
.conv-item .status.confirmed { color: var(--green-600); }
.conv-item .status.rejected { color: #b91c1c; }
.empty-state { text-align: center; padding: 3rem 2rem; background: var(--green-50); border-radius: var(--radius-lg); color: var(--text-muted); }
.empty-state p { margin-bottom: 1rem; }
.empty-state a { color: var(--green-600); font-weight: 500; }
.back-link { display: inline-block; margin-top: 1rem; color: var(--text-muted); text-decoration: none; }
.back-link:hover { color: var(--green-600); }
</style>
{% endblock %}

{% block content %}
<div class="chat-root">
    <div class="chat-header">
        <h1 class="chat-title">Мои чаты</h1>
        <p class="chat-subtitle">Переписка с менеджерами по вашим заявкам на лизинг техники.</p>
    </div>

    {% if lease_requests %}
    <div class="conv-list">
        {% for req in lease_requests %}
        <a href="{% url 'chat:thread' req.id %}" class="conv-item">
            <h3>{{ req.equipment.name }} ({{ req.equipment.model }})</h3>
            <div class="meta">{{ req.equipment.category.name|default:"" }}{% if req.equipment.category %} · {% endif %}Заявка от {{ req.created_at|date:"d.m.Y H:i" }}</div>
            <div class="status {{ req.status }}">
                {% if req.status == 'pending' %}Ожидает подтверждения{% endif %}
                {% if req.status == 'confirmed' %}Подтверждена{% endif %}
                {% if req.status == 'rejected' %}Отклонена{% endif %}
            </div>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <p>У вас пока нет чатов.</p>
        <p><a href="{% url 'core:leasing' %}">Оформите заявку на лизинг</a>, чтобы начать общение с менеджером.</p>
    </div>
    {% endif %}

    <a href="{% url 'core:leasing' %}" class="back-link">Назад к каталогу</a>
</div>
{% endblock %}
