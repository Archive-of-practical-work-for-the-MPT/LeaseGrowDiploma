{% extends 'core/base.html' %}
{% load static %}

{% block title %}–ú–æ—è —Ç–µ—Ö–Ω–∏–∫–∞ ‚Äî LeaseGrow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/home.css' %}">
<link rel="stylesheet" href="{% static 'core/css/leasing.css' %}">
<style>
.my-equipment-hero {
    background:
        radial-gradient(ellipse 120% 100% at 50% -20%, var(--green-100) 0%, transparent 50%),
        radial-gradient(ellipse 80% 60% at 90% 50%, var(--green-50) 0%, transparent 45%),
        var(--bg);
    padding: 3rem 1.5rem 3.5rem;
    text-align: center;
}
.my-equipment-hero h1 {
    font-size: clamp(1.75rem, 4vw, 2.5rem);
    font-weight: 700;
    letter-spacing: -0.03em;
    margin-bottom: 0.5rem;
    color: var(--text);
}
.my-equipment-hero p {
    font-size: 1.0625rem;
    color: var(--text-muted);
    max-width: 540px;
    margin: 0 auto;
    line-height: 1.6;
}
.my-equipment-section {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
}
.my-equipment-empty {
    text-align: center;
    padding: 3rem 1.5rem;
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    color: var(--text-muted);
}
.my-equipment-empty a {
    color: var(--green-600);
    text-decoration: none;
}
.my-equipment-empty a:hover {
    text-decoration: underline;
}
.contract-status {
    display: inline-block;
    padding: 0.2rem 0.6rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 500;
}
.contract-status.active { background: var(--green-100); color: var(--green-600); }
.contract-status.completed { background: var(--border); color: var(--text-muted); }
.contract-status.draft { background: #fef9c3; color: #a16207; }
.contract-status.terminated { background: #fee2e2; color: #dc2626; }
.btn-chat-manager {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    margin-top: auto;
    padding-top: 0.75rem;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: 500;
    color: #fff;
    background: var(--green-500);
    border: none;
    border-radius: var(--radius);
    text-decoration: none;
    transition: background 0.2s, transform 0.1s;
}
.btn-chat-manager:hover {
    background: var(--green-600);
    color: #fff;
    transform: translateY(-1px);
}
.card-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: auto; padding-top: 0.75rem; }
.card-actions a, .card-actions .btn-sm {
    display: inline-flex; align-items: center; gap: 0.35rem;
    padding: 0.4rem 0.75rem; font-size: 0.85rem; font-weight: 500;
    border-radius: var(--radius); text-decoration: none; transition: all 0.2s;
}
.card-actions .btn-chat { background: var(--green-500); color: #fff; border: none; }
.card-actions .btn-chat:hover { background: var(--green-600); color: #fff; }
.card-actions .btn-sign { background: #2563eb; color: #fff; border: none; }
.card-actions .btn-sign:hover { background: #1d4ed8; color: #fff; }
.card-actions .btn-pay { background: #16a34a; color: #fff; border: none; }
.card-actions .btn-pay:hover { background: #15803d; color: #fff; }
.card-actions .btn-maintenance { background: #ca8a04; color: #fff; border: none; }
.card-actions .btn-maintenance:hover { background: #a16207; color: #fff; }
.status-filter { margin-bottom: 1.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap; }
.status-filter a {
    padding: 0.5rem 1rem; border-radius: var(--radius); font-size: 0.9rem;
    text-decoration: none; background: var(--white); border: 1px solid var(--border);
    color: var(--text-secondary);
}
.status-filter a:hover, .status-filter a.active {
    background: var(--green-100); border-color: var(--green-500); color: var(--green-600);
}
</style>
{% endblock %}

{% block content %}
<section class="my-equipment-hero">
    <h1>–ú–æ—è —Ç–µ—Ö–Ω–∏–∫–∞</h1>
    <p>–¢–µ—Ö–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –≤–∑—è–ª–∏ –≤ –ª–∏–∑–∏–Ω–≥ ‚Äî –ø–æ –¥–æ–≥–æ–≤–æ—Ä–∞–º –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–º –∑–∞—è–≤–∫–∞–º. <a href="{% url 'core:my_maintenance_requests' %}" style="color: var(--green-600); text-decoration: none;">–ó–∞—è–≤–∫–∏ –Ω–∞ –¢–û</a></p>
</section>

<div class="my-equipment-section">
    {% if has_any_equipment %}
    <div class="status-filter">
        <a href="{% url 'core:my_equipment' %}" class="{% if not status_filter %}active{% endif %}">–í—Å–µ</a>
        <a href="?status=active" class="{% if status_filter == 'active' %}active{% endif %}">–î–µ–π—Å—Ç–≤—É–µ—Ç</a>
        <a href="?status=completed" class="{% if status_filter == 'completed' %}active{% endif %}">–ó–∞–≤–µ—Ä—à—ë–Ω</a>
        <a href="?status=terminated" class="{% if status_filter == 'terminated' %}active{% endif %}">–†–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç</a>
        <a href="?status=draft" class="{% if status_filter == 'draft' %}active{% endif %}">–ß–µ—Ä–Ω–æ–≤–∏–∫</a>
        <a href="?status=confirmed" class="{% if status_filter == 'confirmed' %}active{% endif %}">–ó–∞—è–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</a>
    </div>
    {% if contracts or confirmed_requests %}
    <div class="leasing-grid">
        {% for contract in contracts %}
        <article class="eq-card">
            <div class="eq-card-image">üöú</div>
            <div class="eq-card-body">
                <h3 class="eq-card-title">{{ contract.equipment.name }} ‚Äî {{ contract.equipment.model }}</h3>
                <p class="eq-card-meta">{{ contract.equipment.category.name }}{% if contract.equipment.manufacturer %} ¬∑ {{ contract.equipment.manufacturer.name }}{% endif %}</p>
                <p class="eq-card-meta" style="margin-top: 0.25rem;">
                    <span class="contract-status {{ contract.status }}">
                        {% if contract.status == 'draft' %}–ß–µ—Ä–Ω–æ–≤–∏–∫{% endif %}
                        {% if contract.status == 'active' %}–î–µ–π—Å—Ç–≤—É–µ—Ç{% endif %}
                        {% if contract.status == 'completed' %}–ó–∞–≤–µ—Ä—à—ë–Ω{% endif %}
                        {% if contract.status == 'terminated' %}–†–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç{% endif %}
                    </span>
                    ¬∑ {{ contract.contract_number }}
                </p>
                {% if contract.company %}
                <p class="eq-card-meta" style="margin-top: 0.25rem;">{{ contract.company.name }}</p>
                {% endif %}
                {% if contract.monthly_payment %}
                <div class="eq-card-rate" style="margin-top: 0.5rem;">{{ contract.monthly_payment|floatformat:0 }} ‚ÇΩ/–º–µ—Å</div>
                {% endif %}
                <p class="eq-card-meta" style="margin-top: 0.5rem; font-size: 0.85rem;">{{ contract.start_date|date:"d.m.Y" }} ‚Äî {{ contract.end_date|date:"d.m.Y" }}</p>
                <div class="card-actions">
                    {% if contract.lease_request_id %}
                    <a href="{% url 'chat:thread' contract.lease_request_id %}" class="btn-chat">üí¨ –ß–∞—Ç</a>
                    {% endif %}
                    {% if contract.status == 'draft' and not contract.signed_at %}
                    <a href="{% url 'core:contract_sign' contract.id %}" class="btn-sign">‚úèÔ∏è –ü–æ–¥–ø–∏—Å–∞—Ç—å</a>
                    {% endif %}
                    {% if contract.status == 'active' %}
                    <a href="{% url 'core:contract_pay' contract.id %}" class="btn-pay">üí∞ –û–ø–ª–∞—Ç–∏—Ç—å</a>
                    <a href="{% url 'core:maintenance_request_create' contract.id %}" class="btn-maintenance">üîß –¢–û</a>
                    {% endif %}
                </div>
            </div>
        </article>
        {% endfor %}
        {% for req in confirmed_requests %}
        <article class="eq-card">
            <div class="eq-card-image">üöú</div>
            <div class="eq-card-body">
                <h3 class="eq-card-title">{{ req.equipment.name }} ‚Äî {{ req.equipment.model }}</h3>
                <p class="eq-card-meta">{{ req.equipment.category.name }}{% if req.equipment.manufacturer %} ¬∑ {{ req.equipment.manufacturer.name }}{% endif %}</p>
                <p class="eq-card-meta" style="margin-top: 0.25rem;">
                    <span class="contract-status active">–ó–∞—è–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</span>
                </p>
                <p class="eq-card-meta" style="margin-top: 0.5rem; font-size: 0.85rem;">–û–∂–∏–¥–∞–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞.</p>
                <a href="{% url 'chat:thread' req.id %}" class="btn-chat-manager">üí¨ –ß–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</a>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="my-equipment-empty">
        <p>–ü–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
        <p style="margin-top: 1rem;"><a href="{% url 'core:my_equipment' %}">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</a></p>
    </div>
    {% endif %}
    {% else %}
    <div class="my-equipment-empty">
        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç–µ—Ö–Ω–∏–∫–∏ –≤ –ª–∏–∑–∏–Ω–≥–µ.</p>
        <p style="margin-top: 1rem;"><a href="{% url 'core:leasing' %}">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</a> –∏ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞—è–≤–∫—É.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
