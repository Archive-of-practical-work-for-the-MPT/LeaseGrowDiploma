{% extends 'core/base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å ‚Äî LeaseGrow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'control_panel/css/control_panel.css' %}">
<link rel="stylesheet" href="{% static 'accounts/css/profile.css' %}?v=2">
{% endblock %}

{% block content %}
<div class="console-root">
    <div class="console-card profile-header" style="margin-bottom: 1.25rem;">
        <div class="console-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="console-subtitle">
            –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –¥–æ—Å—Ç—É–ø –ø–æ —Ä–æ–ª–∏.
        </div>
    </div>

    <div class="console-layout profile-layout">
        <aside class="console-card profile-account-sidebar">
            <h2 class="profile-account-title">–ê–∫–∫–∞—É–Ω—Ç</h2>
            <div class="profile-hero-content">
                <p class="profile-field">
                    <span class="profile-field-label">–§–ò–û:</span>
                    <span class="profile-field-value">{% if profile %}{{ profile.first_name }} {{ profile.last_name }}{% else %}{{ account.username }}{% endif %}</span>
                </p>
                <p class="profile-field">
                    <span class="profile-field-label">–†–æ–ª—å:</span>
                    <span class="profile-field-value">{% if account.role %}{{ account.role.name }}{% else %}‚Äî{% endif %}</span>
                </p>
                <div class="profile-info-row">
                    <div class="profile-info-item">
                        <span class="profile-info-icon">@</span>
                        <span class="profile-info-value">{{ account.email }}</span>
                    </div>
                    {% if profile and profile.phone %}
                    <div class="profile-info-item">
                        <span class="profile-info-icon profile-info-icon-phone">üìû</span>
                        <span class="profile-info-value">{{ profile.phone }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="sidebar-footer">
                <a href="{% url 'core:home' %}" class="console-back-btn">–ù–∞–∑–∞–¥</a>
            </div>
        </aside>

        <section class="profile-main">
            {% if is_client and company_form %}
            <section class="profile-edit-section console-card" style="margin-bottom: 1.5rem;">
                <h2 class="profile-edit-title">–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è</h2>
                {% if need_company and not user_company %}
                <p class="console-help" style="margin-bottom: 1rem; color: var(--text-muted);">–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ –Ω–∞ –ª–∏–∑–∏–Ω–≥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏.</p>
                {% endif %}
                <form method="post" action="{% url 'accounts:profile' %}" class="profile-edit-form console-form">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="company">
                    {% if company_form.non_field_errors %}
                    <div class="console-form-errors">{{ company_form.non_field_errors }}</div>
                    {% endif %}
                    <div class="profile-edit-grid console-form-grid">
                        {% for field in company_form %}
                        <div class="console-field {% if field.errors %}has-error{% endif %}">
                            <label for="{{ field.id_for_label }}">{{ field.label }}{% if field.field.required %} *{% endif %}</label>
                            {{ field }}
                            {% if field.errors %}<span class="field-error">{{ field.errors.0 }}</span>{% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    <div class="console-form-footer">
                        <button type="submit" class="profile-save-btn">{% if user_company %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é{% endif %}</button>
                    </div>
                </form>
            </section>
            {% endif %}

            {% if not is_admin and not is_manager %}
            <section class="profile-edit-section console-card" style="margin-bottom: 1.5rem;">
                <h2 class="profile-edit-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
                <form method="post" action="{% url 'accounts:profile' %}" class="profile-edit-form console-form">
                    {% csrf_token %}
                    {% if form.non_field_errors %}
                    <div class="console-form-errors">{{ form.non_field_errors.0 }}</div>
                    {% endif %}
                    <div class="profile-edit-grid console-form-grid">
                        <div class="console-field {% if form.username.errors %}has-error{% endif %}">
                            <label for="id_username">{{ form.username.label }}</label>
                            {{ form.username }}
                            {% if form.username.errors %}<span class="field-error">{{ form.username.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="console-field {% if form.email.errors %}has-error{% endif %}">
                            <label for="id_email">{{ form.email.label }}</label>
                            {{ form.email }}
                            {% if form.email.errors %}<span class="field-error">{{ form.email.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="console-field {% if form.first_name.errors %}has-error{% endif %}">
                            <label for="id_first_name">{{ form.first_name.label }}</label>
                            {{ form.first_name }}
                            {% if form.first_name.errors %}<span class="field-error">{{ form.first_name.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="console-field {% if form.last_name.errors %}has-error{% endif %}">
                            <label for="id_last_name">{{ form.last_name.label }}</label>
                            {{ form.last_name }}
                            {% if form.last_name.errors %}<span class="field-error">{{ form.last_name.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="console-field {% if form.phone.errors %}has-error{% endif %}">
                            <label for="id_phone">{{ form.phone.label }}</label>
                            {{ form.phone }}
                            {% if form.phone.errors %}<span class="field-error">{{ form.phone.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="console-field profile-edit-field-full {% if form.current_password.errors %}has-error{% endif %}">
                            <label for="id_current_password">{{ form.current_password.label }}</label>
                            {{ form.current_password }}
                            <span class="console-help">–ù—É–∂–µ–Ω –ø—Ä–∏ —Å–º–µ–Ω–µ –ª–æ–≥–∏–Ω–∞, email –∏–ª–∏ –ø–∞—Ä–æ–ª—è</span>
                            {% if form.current_password.errors %}<span class="field-error">{{ form.current_password.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="console-field {% if form.new_password.errors %}has-error{% endif %}">
                            <label for="id_new_password">{{ form.new_password.label }}</label>
                            {{ form.new_password }}
                            {% if form.new_password.errors %}<span class="field-error">{{ form.new_password.errors.0 }}</span>{% endif %}
                        </div>
                        <div class="console-field {% if form.new_password_confirm.errors %}has-error{% endif %}">
                            <label for="id_new_password_confirm">{{ form.new_password_confirm.label }}</label>
                            {{ form.new_password_confirm }}
                            {% if form.new_password_confirm.errors %}<span class="field-error">{{ form.new_password_confirm.errors.0 }}</span>{% endif %}
                        </div>
                    </div>
                    <div class="console-form-footer">
                        <button type="submit" class="profile-save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    </div>
                </form>
            </section>
            {% endif %}

            {% if is_manager or is_admin %}
            <div class="profile-actions">
                {% if is_manager %}
                <a href="{% url 'control_panel:dashboard' %}" class="profile-btn profile-btn-panel">
                    <span class="profile-btn-icon">üìä</span>
                    <span class="profile-btn-text">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    <span class="profile-btn-desc">CRUD —Ç–∞–±–ª–∏—Ü: –∫–æ–º–ø–∞–Ω–∏–∏, —Ç–µ—Ö–Ω–∏–∫–∞, –¥–æ–≥–æ–≤–æ—Ä—ã, –ø–ª–∞—Ç–µ–∂–∏</span>
                </a>
                {% endif %}
                {% if is_manager %}
                <a href="{% url 'manager:statistics' %}" class="profile-btn profile-btn-panel">
                    <span class="profile-btn-icon">üìà</span>
                    <span class="profile-btn-text">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    <span class="profile-btn-desc">–î–∏–∞–≥—Ä–∞–º–º—ã, —Å–≤–æ–¥–∫–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ PDF/Excel</span>
                </a>
                <a href="{% url 'manager:chat' %}" class="profile-btn profile-btn-api">
                    <span class="profile-btn-icon">üí¨</span>
                    <span class="profile-btn-text">–ß–∞—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</span>
                    <span class="profile-btn-desc">–û–±—â–µ–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</span>
                </a>
                {% endif %}
                {% if is_admin %}
                <a href="{% url 'control_panel:dashboard' %}" class="profile-btn profile-btn-panel">
                    <span class="profile-btn-icon">üìä</span>
                    <span class="profile-btn-text">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
                    <span class="profile-btn-desc">CRUD –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Å–∏—Å—Ç–µ–º—ã</span>
                </a>
                <a href="{% url 'accounts:backup' %}" class="profile-btn profile-btn-backup">
                    <span class="profile-btn-icon">üíæ</span>
                    <span class="profile-btn-text">–ë—ç–∫–∞–ø –ë–î</span>
                    <span class="profile-btn-desc">–°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é PostgreSQL</span>
                </a>
                <a href="{% url 'manager:admin_statistics' %}" class="profile-btn profile-btn-panel">
                    <span class="profile-btn-icon">üìà</span>
                    <span class="profile-btn-text">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    <span class="profile-btn-desc">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã: —Å–≤–æ–¥–∫–∏ –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º</span>
                </a>
                {% endif %}
            </div>
            {% endif %}
        </section>
    </div>
</div>
{% endblock %}
